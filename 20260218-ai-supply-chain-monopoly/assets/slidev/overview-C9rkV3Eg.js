import{_ as Z,a as J}from"../modules/unplugin-icons-CqGvfFkS.js";import{f as j,U as Q,M as L,V as ee,W as te,z as a,o,b as k,k as V,n as F,G as le,O as ne,e as _,l as oe,B as ie,r as H,I as se,p as q,P as ae,g as s,F as O,X as P,t as w,j as B,w as E,d as M,Y as ce,A as I,Z as re}from"../modules/vue-BNBRgTGM.js";import{u as ue,s as de,j as me,p as ve,q as T,r as fe,v as R,w as pe,C as U,x as he}from"../index-CRyhIjpM.js";import{_ as ge,C as ke}from"./NoteDisplay.vue_vue_type_style_index_0_lang-Bb16Za6D.js";import{S as be,_ as xe,a as _e}from"./SlideWrapper-CetV8p6x.js";import{_ as A}from"./IconButton.vue_vue_type_script_setup_true_lang-MIBsBGR3.js";import{u as ye}from"./useSlideInfo-LA4s7Df_.js";import"../modules/shiki-Dlr_uPYF.js";const we=["placeholder"],Ce=j({__name:"NoteEditable",props:{no:{type:Number,required:!0},class:{default:""},editing:{default:!1},style:{default:()=>({})},placeholder:{default:"No notes for this slide"},clicksContext:{type:Object},highlight:{default:!0},autoHeight:{default:!1}},emits:["update:editing","markerDblclick","markerClick"],setup(C,{emit:K}){const n=C,y=K,c=ie(n,"editing",y,{passive:!0}),{info:h,update:D}=ye(se(n,"no")),m=H("");let S;const{ignoreUpdates:b}=Q(m,v=>{if(!c.value)return;const u=n.no;clearTimeout(S),S=setTimeout(()=>{D({note:v},u)},500)});L(()=>h.value?.note,(v="")=>{c.value||(clearTimeout(S),b(()=>{m.value=v}))},{immediate:!0,flush:"sync"});const r=H(),x=H();ee(()=>{c.value&&r.value?.focus()}),te(r,()=>{c.value=!1});function N(){!n.autoHeight||!r.value||!c.value||r.value.scrollHeight>r.value.clientHeight&&(r.value.style.height=`${r.value.scrollHeight}px`)}function W(v){c.value&&v.metaKey&&v.key==="s"&&(v.preventDefault(),D({note:m.value},n.no))}return L([m,c],()=>{q(()=>{N()})},{flush:"post",immediate:!0}),(v,u)=>a(c)?le((o(),_("textarea",{key:1,ref_key:"inputEl",ref:r,"onUpdate:modelValue":u[2]||(u[2]=g=>m.value=g),class:F(["prose dark:prose-invert resize-none overflow-auto outline-none bg-transparent block border-primary border-2",n.class]),style:V([{"line-height":"1.75"},[n.style,x.value!=null?{height:`${x.value}px`}:{}]]),placeholder:C.placeholder,onKeydown:[u[3]||(u[3]=oe(g=>c.value=!1,["esc"])),W]},null,46,we)),[[ne,m.value]]):(o(),k(ge,{key:0,class:F(["border-transparent border-2",[n.class,m.value?"":"opacity-25 italic select-none"]]),style:V(n.style),note:m.value||C.placeholder,"note-html":a(h)?.noteHTML,"clicks-context":C.clicksContext,"auto-scroll":!C.autoHeight,highlight:n.highlight,onMarkerClick:u[0]||(u[0]=(g,$)=>y("markerClick",g,$)),onMarkerDblclick:u[1]||(u[1]=(g,$)=>y("markerDblclick",g,$))},null,8,["class","style","note","note-html","clicks-context","auto-scroll","highlight"]))}}),De={class:"h-screen w-screen of-hidden flex"},$e={class:"grid grid-rows-[auto_max-content] border-r border-main select-none max-h-full h-full"},Fe={class:"relative"},Se={class:"absolute left-0 top-0 bottom-0 w-200 flex flex-col flex-auto items-end group p2 gap-1 max-h-full of-x-visible of-y-auto",style:{direction:"rtl"}},Ee=["onClick"],Me={p2:"",border:"t main"},He={class:"select-none w-13 text-right my4 flex flex-col gap-1 items-end"},Ne={class:"text-3xl op20 mb2"},Be=["onDblclick"],Te={class:"py3 mt-0.5 mr--8 ml--4 op0 transition group-hover:op100"},Ae={key:0,class:"select-none absolute bottom-0 right-0 bg-main rounded-tl p2 op35 text-xs"},Ve={class:"absolute top-0 right-0 px3 py1.5 border-b border-l rounded-lb bg-main border-main select-none"},We={class:"text-xs op50"},z=450,je=j({__name:"overview",setup(C){ue({title:`Overview - ${de}`});const{openInEditor:K,slides:n}=me(),y=ce(new Map),c=H([]),h=H(null),D=I(()=>n.value.map(e=>v(e.meta?.slide?.note||""))),m=I(()=>D.value.reduce((e,t)=>e+t,0)),S=I(()=>n.value.map(e=>N(e)).reduce((e,t)=>e+t,0)),b=re(),r=new WeakMap;function x(e){return r.has(e)||r.set(e,pe(e,U)),r.get(e)}function N(e){return e.meta?.clicks||x(e)?.total}function W(e){b.value===e?b.value=void 0:b.value=e}function v(e){const t=/[\w`'\-\u0392-\u03C9\u00C0-\u00FF\u0600-\u06FF\u0400-\u04FF]+|[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\u3040-\u309F\uAC00-\uD7AF]+/g,i=e.match(t);let f=0;if(!i)return 0;for(let l=0;l<i.length;l++)i[l].charCodeAt(0)>=19968?f+=i[l].length:f+=1;return f}function u(e){const t=e.getBoundingClientRect(),i=20;return t.top>=0-i&&t.left>=0-i&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)+i&&t.right<=(window.innerWidth||document.documentElement.clientWidth)+i}function g(){const e=[];Array.from(y.entries()).forEach(([t,i])=>{u(i)&&e.push(t)}),c.value=e}function $(e){const t=document.createElement("a");t.target="_blank",t.href=he+e.slice(1),t.click()}function X(e){const t=y.get(e);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function G(e,t,i){const f=x(i);f.current===t?f.current=U:f.current=t,e.preventDefault()}return ae(()=>{q(()=>{g()})}),(e,t)=>{const i=Z,f=J;return o(),_("div",De,[s("nav",$e,[s("div",Fe,[s("div",Se,[(o(!0),_(O,null,P(a(n),(l,p)=>(o(),_("div",{key:l.no,class:"relative",style:{direction:"ltr"}},[s("button",{class:F(["relative transition duration-300 w-8 h-8 rounded hover:bg-active hover:op100",c.value.includes(p)?"op100 text-primary bg-gray:5":"op20"]),onClick:d=>X(p)},[s("div",null,w(p+1),1)],10,Ee),l.meta?.slide?.title?(o(),_("div",{key:0,class:F(["pointer-events-none select-none absolute left-110% top-50% translate-y--50% ws-nowrap z-label px2 slidev-glass-effect transition duration-400 op0 group-hover:op100",c.value.includes(p)?"text-primary":"text-main important-text-op-50"])},w(l.meta?.slide?.title),3)):B("v-if",!0)]))),128))])]),s("div",Me,[a(ve)?(o(),k(A,{key:1,title:a(T)?"Dark mode":"Light mode","pointer-events-none":"",op50:""},{default:E(()=>[a(T)?(o(),k(i,{key:0})):(o(),k(f,{key:1}))]),_:1},8,["title"])):(o(),k(A,{key:0,title:a(T)?"Switch to light mode theme":"Switch to dark mode theme",onClick:t[0]||(t[0]=l=>a(fe)())},{default:E(()=>[a(T)?(o(),k(i,{key:0})):(o(),k(f,{key:1}))]),_:1},8,["title"]))])]),s("main",{class:"flex-1 h-full of-auto",style:V(`grid-template-columns: repeat(auto-fit,minmax(${z}px,1fr))`),onScroll:g},[(o(!0),_(O,null,P(a(n),(l,p)=>(o(),_("div",{key:l.no,ref_for:!0,ref:d=>y.set(p,d),class:F(["relative border-t border-main of-hidden flex gap-4 min-h-50 group",p===0?"pt5":""])},[s("div",He,[s("div",Ne,w(p+1),1),M(A,{class:"mr--3 op0 group-hover:op80",title:"Play in new tab",onClick:d=>$(a(R)(l,!1))},{default:E(()=>[...t[2]||(t[2]=[s("div",{class:"i-carbon:presentation-file"},null,-1)])]),_:1},8,["onClick"]),B("v-if",!0)]),s("div",{class:"flex flex-col gap-2 my5",style:V({width:`${z}px`})},[s("div",{class:"border rounded border-main overflow-hidden bg-main select-none h-max",onDblclick:d=>$(a(R)(l,!1))},[(o(),k(_e,{key:l.no,width:z,class:"pointer-events-none important:[&_*]:select-none"},{default:E(()=>[M(be,{"clicks-context":x(l),route:l,"render-context":"overview"},null,8,["clicks-context","route"]),M(xe,{page:l.no},null,8,["page"])]),_:2},1024))],40,Be),N(l)?(o(),k(ke,{key:0,active:b.value===l,"clicks-context":x(l),class:"w-full mt-2",onDblclick:d=>W(l),onClick:d=>b.value=l},null,8,["active","clicks-context","onDblclick","onClick"])):B("v-if",!0)],4),s("div",Te,[M(A,{title:"Edit Note",class:F(["rounded-full w-9 h-9 text-sm",h.value===l.no?"important:op0":""]),onClick:d=>h.value=l.no},{default:E(()=>[...t[4]||(t[4]=[s("div",{class:"i-carbon:pen"},null,-1)])]),_:1},8,["class","onClick"])]),M(Ce,{no:l.no,class:"max-w-250 w-250 text-lg rounded p3","auto-height":!0,highlight:b.value===l,editing:h.value===l.no,"clicks-context":x(l),onDblclick:d=>h.value!==l.no?h.value=l.no:null,"onUpdate:editing":t[1]||(t[1]=d=>h.value=null),onMarkerClick:(d,Y)=>G(d,Y,l)},null,8,["no","highlight","editing","clicks-context","onDblclick","onMarkerClick"]),D.value[p]>0?(o(),_("div",Ae,w(D.value[p])+" words ",1)):B("v-if",!0)],2))),128))],36),s("div",Ve,[s("div",We,w(a(n).length)+" slides · "+w(S.value+a(n).length-1)+" clicks · "+w(m.value)+" words ",1)])])}}});export{je as default};
